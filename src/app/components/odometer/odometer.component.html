<div class="odometer-container">
  <header class="header">
    <button class="back-btn" (click)="goBack()">← Kembali</button>
    <h1>Pembacaan Odometer</h1>
  </header>

  <main class="odometer-content">
    <div class="odometer-card" [class]="tripType.toLowerCase() + '-trip'">
      <!-- Trip Header Info -->
      <div class="trip-header-info">
        <div class="trip-number-display">
          <span class="trip-label">Nomor SPK:</span>
          <span class="trip-value">{{ tripNumber }}</span>
        </div>
        <div class="plate-number-display">
          <span class="plate-label">Plat Nomor:</span>
          <span class="plate-value">{{ plateNumber }}</span>
        </div>
        <div class="driver-display">
          <span class="driver-label">Driver:</span>
          <span class="driver-value">{{ tripDriver || '-' }}</span>
        </div>
      </div>

      <form (ngSubmit)="onSubmit()" class="odometer-form">
        <div class="form-section">
          <div class="form-group">
            <label for="odometer" class="required">Pembacaan Odometer (KM)</label>
            <input
              type="number"
              id="odometer"
              [(ngModel)]="odometerReading"
              name="odometerReading"
              placeholder="Masukkan pembacaan odometer saat ini"
              class="odometer-input"
              min="0"
              step="0.1"
              required
              autocomplete="off"
            />
          </div>

          <!-- Foto Odometer -->
          <div class="form-group">
            <label class="required">Foto Odometer</label>
            <div class="photo-section">
              <div class="photo-actions">
                <label class="photo-btn camera-btn" style="color: white;">
                  Kamera
                  <input type="file" accept="image/*" capture="environment" (change)="onPhotoSelected($event, 'odometer')" hidden />
                </label>
                <button *ngIf="odometerPhoto" type="button" class="remove-photo-btn" (click)="removePhoto('odometer')">Hapus</button>
              </div>
              <img *ngIf="odometerPhoto" [src]="odometerPhoto" class="photo-preview" />
            </div>
          </div>

          <!-- Foto Muatan -->
          <div class="form-group">
            <label class="required">Foto Muatan</label>
            <div class="photo-section">
              <div class="photo-actions">
                <label class="photo-btn camera-btn" style="color: white;">
                  Kamera
                  <input type="file" accept="image/*" capture="environment" (change)="onPhotoSelected($event, 'cargo')" hidden />
                </label>
                <button *ngIf="cargoPhoto" type="button" class="remove-photo-btn" (click)="removePhoto('cargo')">Hapus</button>
              </div>
              <img *ngIf="cargoPhoto" [src]="cargoPhoto" class="photo-preview" />
            </div>
          </div>

          <div class="form-group">
            <label for="jumlah-muatan" class="required">
              Jumlah Muatan:
              <span class="expected-muatan" *ngIf="muatanType === 'CYLINDER' && expectedMuatan !== null">
                (Sistem: {{ expectedMuatan }} cylinder)
              </span>
            </label>
            <input
              type="number"
              id="jumlah-muatan"
              [(ngModel)]="jumlahMuatan"
              name="jumlahMuatan"
              placeholder="Masukkan hasil perhitungan jumlah muatan"
              class="odometer-input"
              [class.input-error]="muatanMismatchWarning"
              min="0"
              step="0.1"
              required
              autocomplete="off"
            />
            <div class="muatan-warning" *ngIf="muatanMismatchWarning">
              Jumlah muatan yang dimasukkan ({{ jumlahMuatan }}) tidak sesuai dengan data sistem ({{ expectedMuatan }} cylinder). Pastikan kembali sebelum melanjutkan.
            </div>
          </div>

          <div class="form-group">
            <label for="notes">Catatan Tambahan (Opsional)</label>
            <textarea
              id="notes"
              [(ngModel)]="notes"
              name="notes"
              placeholder="Masukkan catatan atau pengamatan tambahan"
              class="textarea-input"
              rows="4"
              autocomplete="off"
            ></textarea>
          </div>
        </div>

        <div class="photo-upload-warning" *ngIf="photoUploadWarning">
          ⚠️ {{ photoUploadWarning }}
        </div>

        <div class="form-actions">
          <button type="submit"
                  class="complete-btn"
                  [ngStyle]="getButtonStyle()">
            Selesaikan Registrasi Perjalanan
          </button>
        </div>
      </form>
    </div>
  </main>
</div>
